<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="CPH Landing Page Prototype">
  <meta name="author" content="Allen Nikka">
  <link rel="icon" href="../../favicon.ico">

  <title>CPH Monitoring Page</title>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Bootstrap theme -->
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

</head>

<body onload="init()">


    <!-- Modal -->
    <!-- FIXME: modal turned off -->
    <!--
  <div class="modal fade" id="offModal" tabindex="-1" role="dialog" aria-labelledby="offModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="offModalLabel">Unrecognized Shutoff</h4>
        </div>
        <div class="modal-body">
          An unrecognized device shutoff event has been detected, would you like to store this power signature?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">No, Close</button>
          <input type="text" name="offModalInput" id="offModalName" placeholder="Input Unique Name Here">
          <button type="button" class="btn btn-primary"  id="offModalSave" data-dismiss="modal">Yes, Save</button>
        </div>
      </div>
    </div>
  </div> -->
<!-- FIXME: modal turned off -->
<!--
  <div class="modal fade" id="onModal" tabindex="-1" role="dialog" aria-labelledby="onModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="onModalLabel">Unrecognized Turn-On</h4>
        </div>
        <div class="modal-body">
          An unrecognized device turn on event has been detected, would you like to store this power signature?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">No, Close</button>
          <input type="text" name="onModalInput" id="onModalName" placeholder="Input Unique Name Here">
          <button type="button" class="btn btn-primary" id="onModalSave" data-dismiss="modal">Yes, Save</button>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Fixed navbar -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="#">CPH Homepage</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="#logout" onclick="logout()">Log Out</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li role="separator" class="divider"></li>
              <li class="dropdown-header">Nav header</li>
              <li><a href="#">Separated link</a></li>
              <li><a href="#">One more separated link</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container theme-showcase" role="main">

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <!-- <div class="jumbotron">
      <h1>CyberPowered Home Dashboard</h1>
      <p>Welcome to Cyberpowered Home's prototype user interface. Scroll over any of the sections below for more information on how to interact with them.</p>
    </div> -->
    <br>


    <div class="row">
      <div class="col-md-6">
        <div class="page-header">
            <h1 data-toggle="tooltip" title="View Data on Power consumptuion and frequency spectrum of consumed power across circuits" data-placement="auto" >Power Consumption</h1>
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Power</th>
            </tr>
          </thead>
        </table>
        <div class="powerCharts"  id="powerChart">

        </div>
        <p>
          <label> View Past: </label>
          <input type="number" id="r0" name="win_length" placeholder="Number of..." onchange="updateDisplay()" size="autosize" value="1">
        </p>
        <p>
          <input type="radio" id="r2" name="display" value="Hour"> Hour(s)
          <input type="radio" id="r3" name="display" value="Day"> Day(s)
          <input type="radio" id="r6" name="display" value="Week" > Week(s)
          <input type="radio" id="r4" name="display" value="Month" > Month(s)
          <input type="radio" id="r5" name="display" value="Year" checked> Year(s)
        </p>
        <p>
          <label>Number of Minutes per interval (lower increases load time);
            <input type="number" name="StepNumber" id="numSteps" value="60" onchange="updateDisplay()" size="autosize">
          </label>
        </p>
      </div>
      <div class="col-md-6">
        <div class="page-header" id="Circuit_Controls">
          <h1 data-toggle="tooltip" title="See and manage your devices" data-placement="auto" >Device Management</h1>
        </div>
        <div id="control">
          <p>
            <form method="post" name="setRelay">
              <labelfor="relay1On" data-toggle="tooltip" title="Turn the connected circuits and/or devices on or off" data-placement="auto" >Living Room Circuit Control:</label>
              <input type="radio" id="relay1On" name="setRelay1" value="on" checked> Circuit On
              <input type="radio" id="relay1Off" name="setRelay1" value="off"> Circuit Off
            </form>
          </p>
        </div>
        <table class="table">
          <thead>
            <tr>
              <th data-toggle="tooltip" title="Learned devices that are currently active" data-placement="auto" >Active Devices</th>
              <th> Power Consumption (W) </th>
              <!-- <th> Power Factor </th> -->
            </tr>
          </thead>
          <tbody id="successDevices">
            <td></td>
          </tbody>
        </table>
        <table class="table">
          <br>
          <thead>
            <tr>
              <th data-toggle="tooltip" title="Devices the system has learned the signature of" data-placement="auto" >Classified Devices</th>
              <th> Power Consumption (W) </th>
              <!-- <th> Power Factor </th> -->
            </tr>
          </thead>
          <tbody id="devices">
          </tbody>
        </table>
          <!-- FIXME -->
      <!-- <table class="table">
          <thead>
            <tr>
              <th>Harmonics</th>
            </tr>
          </thead>
        </table>
        <div class="harmoicsBars">
          <label>0th Harmonic</label>
          <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 50%;" id="h1_bar"> <label id="h1_bar_label">0th Harmonic</label> </div>
          </div>
          <label>1st Harmonic</label>
          <div class="progress">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%" id="h2_bar"> <label id="h2_bar_label">1st Harmonic </label></div>
          </div>
          <label>2nd Harmonic</label>
          <div class="progress">
            <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%" id="h3_bar"><label id="h3_bar_label"> 2nd Harmonic </label></div>
          </div>
          <label>3rd Harmonic</label>
          <div class="progress">
            <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%" id="h4_bar"> <label id="h4_bar_label">3rd Harmonic </label></div>
          </div>
          <label>4th Harmonic</label>
          <div class="progress">
            <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%" id="h5_bar"> <label id="h5_bar_label">4th Harmonic </label></div>
          </div>
          <label>5th Harmonic</label>
          <div class="progress">
            <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%" id="h6_bar"> <label id="h6_bar_label">5th Harmonic </label></div>
          </div>
        </div> -->
      </div>
    </div>

    <!-- <div class="page-header" id="Circuit_Controls">
      <h1 data-toggle="tooltip" title="See and manage your devices" data-placement="auto" >Device Management</h1>
    </div> -->
    <!-- <div class="row">
      <div class="col-md-6">
        <p>
          <label data-toggle="tooltip" title="Input the name of the device that was just activated and press submit
          to add it to the list of classified devices" data-placement="auto" >Device Name:</label> <input type="text" id="deviceName"/>
          <button type="button" class="btn btn-sm btn-success" onclick="createDevice('2');">Submit</button>
        </p>
      </div>
      <div class="col-md-6">
        <div id="control">
          <p>
            <form method="post" name="setRelay">
              <labelfor="relay1On" data-toggle="tooltip" title="Turn the connected circuits and/or devices on or off" data-placement="auto" >Living Room Circuit Control:</label>
              <input type="radio" id="relay1On" name="setRelay1" value="on" checked> Circuit On
              <input type="radio" id="relay1Off" name="setRelay1" value="off"> Circuit Off
            </form>
          </p>
        </div>
      </div>
    </div> -->





    <!-- <div class="page-header">
      <h1>All Devices</h1>
    </div> -->

    <!-- <div class="row">
      <div class="col-md-6">
        <table class="table">
          <thead>
            <tr>
              <th data-toggle="tooltip" title="Learned devices that are currently active" data-placement="auto" >Active Devices</th>
              <th> Power Consumption (W) </th>
              <th> Power Factor </th>
            </tr>
          </thead>
          <tbody id="successDevices">
          </tbody>
        </table>
      </div>
      <div class="col-md-6">
        <table class="table">
          <thead>
            <tr>
              <th data-toggle="tooltip" title="Devices the system has learned the signature of" data-placement="auto" >Classified Devices</th>
              <th> Power Consumption (W) </th>
              <th> Power Factor </th>
            </tr>
          </thead>
          <tbody id="devices">
          </tbody>
        </table>
      </div>
    </div> -->

  </div>
  <!-- /container -->


  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>


  <script>

    $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();
    });

    $('#offModal').on('shown.bs.modal', function () {
      $('#myInput').focus()
    });

    $('#onModal').on('shown.bs.modal', function () {
      $('#myInput').focus()
    });


    function test(a){
      $('#onModal').modal('show');
      $('#onModalSave').on('click', function(){
        var deviceName = document.getElementById("onModalName").value;
        alert(deviceName);
      });
    }
    function logout(){
      window.location.replace('loginV4.html');
    }
    //page load call, to hide elements and make clear the need to log-in
    function init() {
      // document.getElementById("charts").style.display = "none";
      // document.getElementById("devices").style.display = "none";
      // document.getElementById("successDevices").style.display = "none";
      // document.getElementById("Circuit_Controls").style.display = "none";
      // // document.getElementById("r2").style.display = "none";
      // document.getElementById("Control").style.display = "none";
      // document.getElementById("Teaching").style.display = "none";
      updateDisplay();
    }


    //global vars
    var user = 'userA1'; //FIXME: need to use express to do routing and deal with session variables
    var socketio = io.connect();

    //function used to login a user
    function login() {
      var userTemp = document.getElementById("username").value;
      var pass = document.getElementById("password").value;
      if (userTemp === "") {
        alert("You must enter a username");
      } else {
        user = userTemp;
        socketio.emit("login_attempt", {
          userName: user,
          password: pass
        });
      }
    }

    socketio.on("refreshDisplay", function(){
      updateDisplay();
    });

    //update graphs
    function updateDisplay() {
      // console.log("Display updated")
      var dimension;
      var win_length = document.getElementById('r0').value;
      var numSteps = document.getElementById('numSteps').value;
      if(isNaN(win_length)) win_length = 1;
      if (document.getElementById('r2').checked) {
        dimension = document.getElementById('r2').value;
      }
      if (document.getElementById('r3').checked) {
        dimension = document.getElementById('r3').value;
      }
      if (document.getElementById('r4').checked) {
        dimension = document.getElementById('r4').value;
      }
      if (document.getElementById('r5').checked) {
        dimension = document.getElementById('r5').value;
      }
      if (document.getElementById('r6').checked) {
        dimension = 'Day';
        win_length *= 7;
      }
      if(user) {
        // alert("Resize Display: " +dimension + " by " + user);
        socketio.emit("updateDisplay", {
          user: user,
          dimension: dimension,
          win_length: win_length,
          numSteps:numSteps,
          resize: true
        });
      }

    }

    //call used to begin creation of device
    function createDevice(number) {
      if (number == 1) {
        alert("number is 1!");
      }

      var deviceName = document.getElementById("deviceName").value;
      document.getElementById("deviceName").value = '';

      socketio.emit("createDevice", {
        user: user,
        deviceName: deviceName
      });
    }


    //updating screen in response to successful login
    socketio.on("loginResult", function(data) {
      if (!data.successUser) {
        alert("Username not recognized");
      } else {
        if (!data.successPass) {
          alert("Password incorrect");
        }
      }
      if (data.successUser && data.successPass) {
        alert(data.user + " is logged-in");
        user = data.user;
        document.getElementById("charts").style.display = "block";
        document.getElementById("devices").style.display = "block";
        document.getElementById("successDevices").style.display = "block";
        document.getElementById("Circuit_Controls").style.display = "block";
        document.getElementById("login").style.display = "none";
        document.getElementById("Control").style.display = "block";

        document.getElementById("devices").innerHTML = "Identified devices: ";
        document.getElementById("successDevices").innerHTML = "Currently powered devices: ";

        updateDisplay();
        socketio.emit("pullDevices", {
          user: user
        });

      }
    });

    //Relay control functions
    document.getElementById("relay1On").onclick = function() {
      socketio.emit("setRelay", {
        name: 'setRelay1',
        data: "ON"
      });
    }

    document.getElementById("relay1Off").onclick = function() {
      socketio.emit("setRelay", {
        name: 'setRelay1',
        data: "OFF"
      });
    }

    // view radio buttons
    for (var i = 2; i < 7; i++) {
      document.getElementById("r"+i).onclick = function() {
          updateDisplay();
      }
    }

    // document.getElementById("r0").onchange() = function() {
    //       updateDisplay();
    // }
    // document.getElementById("numSteps").onchange() = function() {
    //       updateDisplay();
    // }
    //
    // function emitDisplay(element) {
    //
    //   socketio.emit("updateDisplay", {
    //     user: user,
    //     view: element.value
    //   });
    // }

    //response to success full logged change
    socketio.on("changeLogged", function(data) {
      // alert("change logged"); //FIXME: commented this because it was getting annoying
      updateDisplay();
      // var learningModeOn = false;
      // if (document.getElementById("learningOn").checked) {
      //   learningModeOn = true;
      // }
      // socketio.emit("pullDevices", {
      //   user: user,
      //   learningModeOn: learningModeOn
      // });

    });

    // //response to device being successfully created
    // socketio.on("deviceCreated", function(data) {
    //   if(!(data.error)){
    //     alert("device " + data.deviceName + " has been created");
    //   } else {
    //     alert("Error: " + data.error);
    //   }
    //
    //   var learningModeOn = false;
    //   if (document.getElementById("learningOn").checked) {
    //     learningModeOn = true;
    //   }
    //   socketio.emit("pullDevices", {
    //     user: user,
    //     learningModeOn: learningModeOn
    //   });
    //
    //
    // });

    //creating updated list of known devices
    socketio.on("devicesUpdate", function(data) {
      // console.log("Listing " + data.deviceName);
      var myNode = document.getElementById("devices");
      if (data.first === true) {
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }
        // myNode.innerHTML = "Identified devices: ";
      }
      var new_row = myNode.appendChild(document.createElement("tr"));
      // console.log("Data: " + data.deviceName +" "+ data.Pfactor )
      myNode.appendChild(document.createElement("td"));
      new_row.insertCell(0).innerHTML = data.deviceName;
      new_row.insertCell(1).innerHTML = data.realP;
      // new_row.insertCell(2).innerHTML = data.Pfactor;
    });

    socketio.on("devicesPowered", function(data) {
      var myNode = document.getElementById("successDevices");
      if(data.posChange){
        alert(data.deviceName + "turned on");
        var new_row = myNode.appendChild(document.createElement("tr"));

        myNode.appendChild(document.createElement("td"));
        new_row.insertCell(0).innerHTML = data.deviceName;
        new_row.insertCell(1).innerHTML = data.realP;
        new_row.insertCell(2).innerHTML = data.Pfactor;
      } else {
        alert(data.deviceName + "turned off");

        var searchString = data.deviceName;
        $("#successDevices tr td:contains('" + searchString  + "')").each(function() {
            if ($(this).text() == searchString) {
                $(this).parent().remove();
            }
        });
      }

      // if (data.first === true) {
      //   while (myNode.firstChild) {
      //       myNode.removeChild(myNode.firstChild);
      //   }
      //   // myNode.innerHTML = "Identified devices: ";
      // }

    });

    socketio.on("requestName", function(data) {
      document.getElementById("Circuit_Controls").style.display = "block";
      alert("Unrecognized device connected to system! Please name it");
      alert(data.mostRecent);

    });


    //ALL BELOW IS GRAPH BUILDER

    //global graphing vars
    var chart1DataX = [];
    var chart1DataY= [];
    var chart1DataY2= [];
    var prevE = 0.0;
    cost_mult = 0.00012;


    // unrecognized change has been detected, prompt user to input data
    socketio.on("promptDeviceAdd", function(data) {
      var deviceName = "";

      if(data.error) alert("Error: " + data.error );
      if(data.posChange){
        $('#onModal').modal('show');
        $('#onModalSave').on('click', function(){
          deviceName = document.getElementById("onModalName").value;
          document.getElementById("onModalName").value = "";
          // alert(deviceName + "now on" + "with data length: " + data.length); //FIXME - remove
          console.log("adding a device call from on" )
          promptDeviceAddHelper(deviceName, data);
        });
      } else {
        $('#offModal').modal('show');
        $('#offModalSave').on('click', function(){
          deviceName = document.getElementById("offModalName").value;
          document.getElementById("offModalName").value = "";
          // alert(deviceName + "now off"); //FIXME - remove
          console.log("adding a device call from off" )
          promptDeviceAddHelper(deviceName, data);
        });
      }

    });

    function promptDeviceAddHelper(deviceName, data){
      // data.deviceName, data.user, data.changePrompt, data.changeData
      // var data_diff = data.diff;
      // // console.log("device being added:")
      for (var k in data_diff) {
        if (data_diff.hasOwnProperty(k)) {
          console.log(k + " : " + data_diff[k]);
        }
      }
      if(!(deviceName === "")) {
      //   //only add to active devices if it is a positive change
      //   if(data.posChange){
      //     var myNode = document.getElementById("successDevices");
      //     // if (data.first === true) {
      //     //   while (myNode.firstChild) {
      //     //       myNode.removeChild(myNode.firstChild);
      //     //   }
      //     //   // myNode.innerHTML = "Identified devices: ";
      //     // }
      //     var new_row = myNode.appendChild(document.createElement("tr"));
      //
      //     myNode.appendChild(document.createElement("td"));
      //     new_row.insertCell(0).innerHTML = deviceName;
      //     new_row.insertCell(1).innerHTML = data_diff.realP;
      //     new_row.insertCell(2).innerHTML = data_diff.Pfactor;
      //   }
        socketio.emit("createDevice", {
          deviceName: deviceName,
          user: data.user,
          changePrompt: true,
          changeData: data.diff,
          posChange: data.posChange
        });
      }


      // for (var k in data.diff) {
      //   if (data.diff.hasOwnProperty(k)) {
      //     console.log(k + " : " + data[k])
      //   }
      // }
    }

    socketio.on("deviceCreated", function(data){

    })

    //update result return, prepare for graph building
    socketio.on("updateResult", function(data) {

      if(data.clearGraphs){
        chart1DataX = [];
        chart1DataY = [];
        chart1DataY2= [];
        prevE = 0;

      }
      chart1DataX.push(data.x);
      chart1DataY.push(data.y);

      chart1DataY2.push((parseFloat(data.y2) + (prevE))*cost_mult);
      prevE += parseFloat(data.y2);


      //FIXME: for making harmonics
      // chartHDataX.push(data.xH);
      // chartHDataY.push(data.yH);
      if (data.final) {
        // chartMaker(chart1DataX, chart1DataY, "powerChart");
        // FIXME: for making harmonics
        // chartMaker(chartHDataX, chartHDataY, "harmonics");
        // chartMaker(data.xH, data.yH, "harmonicsChart");
        setHarmonicBars(data.xH, data.yH);

        var trace1 = {
          x: chart1DataX,
          y: chart1DataY,
          mode: 'lines+markers',
          line: {shape: 'hv'}, //was vh, trying hv
          type: 'scatter',
          name: 'Power (W)'
        };
        var trace2 = {
          x: chart1DataX,
          y: chart1DataY2,
          yaxis:'y2',
          mode: 'lines+markers',
          line: {shape: 'linear'}, //{shape: 'vh'},
          type: 'scatter',
          name: 'Cost (USD)'
        };

        var data = [trace1, trace2];

        var layout = {
          autosize: false,
          width: 500,
          height: 500,
          margin: {
            l: 50,
            r: 50,
            b: 100,
            t: 100,
            pad: 4
          },
          yaxis: {title: 'Power (Watts)'},
         yaxis2: {
           title: 'Total Cost (USD)',
           overlaying: 'y',
           side: 'right'
         },
         legend: {x:0.5,y:-0.5},
          paper_bgcolor: '#7f7f7f',
          plot_bgcolor: '#c7c7c7',
          font: {
             family: 'Arial',
             size: 14,
             color: 'black'
           }

        };


        Plotly.newPlot("powerChart", data, layout);

      }


    });

    function setHarmonicBars(xH, yH){
        // h1_bar
        // <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 100%;" id="h1_bar">
        // var numHarmonics = 6;
        // for (var i = 0; i < numHarmonics; i++) {
        //   let id = "h" + (i+1) + "_bar";
        //   let hBar = document.getElementById(id);
        //   hBar.style = "width: " + yH[i] + "%";
        //   // hBar.(aria-valuenow) = yH[i];
        //   id = "h" + (i+1) + "_bar_label";
        //   hBar = document.getElementById(id);
        //   if(hBar) {
        //     hBar.removeChild(hBar.firstChild);
        //     hBar.appendChild(document.createTextNode(yH[i] + "%"));
        //   }
        //
        // }
    }

    function chartMaker(chartDataX, chartDataY, elementID) {
      //below is Easle.JS work to create charts
      var stacksDiv = document.getElementById(elementID);
      var traces = [{
          x: chartDataX,
          y: chartDataY,
          mode: 'lines+markers',
          line: {shape: 'linear'}, //FIXME: needs to be different for harmonics, use vhv or linear
          type: 'scatter',
          name: 'Power'
        },];

      var layout = {
        autosize: false,
        width: 500,
        height: 500,
        margin: {
          l: 50,
          r: 50,
          b: 100,
          t: 100,
          pad: 4
        },
        paper_bgcolor: '#7f7f7f',
        plot_bgcolor: '#c7c7c7'

      };

      // Plotly.newPlot(stacksDiv, stackedArea(traces), layout);
      Plotly.newPlot(stacksDiv, traces, layout);
    }

    function stackedArea(traces) {
      for (var i = 1; i < traces.length; i++) {
        for (var j = 0; j < (Math.min(traces[i]['y'].length, traces[i - 1]['y'].length)); j++) {
          traces[i]['y'][j] += traces[i - 1]['y'][j];
        }
      }
      return traces;
    }

  </script>

  </script>
</body>

</html>
